[Unit]
Description="{{ host_name.split('.')[0] }} validator - Polkadot service"
After=network.target
StartLimitIntervalSec=0

[Service]
Type=simple
Restart=on-failure
RestartSec=10
User={{ polkadot_user }}
Group={{ polkadot_group }}
SyslogIdentifier={{ polkadot_service }}
LimitNOFILE={{ default_max_open_files_in_service }}
SyslogFacility=local7
KillSignal=SIGHUP
ExecStart={{ polkadot_base }}/polkadot \
     --base-path {{ polkadot_base }} \
     --chain {{ polkadot_network }} \
     --database {{ polkadot_database }} \
     --sync {{ polkadot_syncmode }} \
     --name "{{ hostvars[inventory_hostname]['default_telemetry_name'] | default(host_name) }}" \
     --telemetry-url 'wss://telemetry-backend.w3f.community/submit 1' \
     --port {{ polkadot_p2p_port }} \
     --rpc-port {{ polkadot_rpc_port }} \
     --prometheus-port {{ polkadot_prom_port }} \
     --execution wasm \
     --wasm-execution compiled \
     --pruning 1000 \
     --db-cache {{ ansible_memtotal_mb // 2 }}

[Install]
WantedBy=multi-user.target
