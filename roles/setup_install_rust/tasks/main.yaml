# Standards: 0.2
---
- name: Install required dependencies
  ansible.builtin.package:
    name: libssl-dev
    state: present

- name: Check if Rust is already installed
  ansible.builtin.command:
    cmd: /usr/local/cargo/bin/rustup --version
  register: rust_check
  failed_when: False
  changed_when: False

- name: Download Rust installer if not present
  ansible.builtin.get_url:
    url: https://sh.rustup.rs
    dest: "/tmp/sh.rustup.rs"
    mode: '0755'
    force: False

- name: Install Rust if not present
  ansible.builtin.shell:
    cmd: sh /tmp/sh.rustup.rs -y --no-modify-path
  environment:
    CARGO_HOME: "/usr/local/cargo"
    RUSTUP_HOME: "/usr/local/rustup"
  when: rust_check.rc != 0

- name: Ensure Rust's cargo is globally accessible
  ansible.builtin.lineinfile:
    path: "/etc/profile.d/rust.sh"
    line: "export PATH=/usr/local/cargo/bin:$PATH"
    create: True
    owner: root
    group: root
    mode: '0644'

- name: Update Rust toolchain to stable
  ansible.builtin.shell:
    cmd: "/usr/local/cargo/bin/rustup default stable"

- name: Update Rust toolchain
  ansible.builtin.shell:
    cmd: "/usr/local/cargo/bin/rustup update"

- name: Add the nightly and WebAssembly targets
  ansible.builtin.shell:
    cmd: "/usr/local/cargo/bin/rustup update nightly"
...
