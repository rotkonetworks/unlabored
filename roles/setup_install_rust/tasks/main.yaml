# Standards: 0.2
---
- name: Install OpenSSL development package
  ansible.builtin.package:
    name: libssl-dev
    state: present

- name: Check if Rust directories exist
  ansible.builtin.stat:
    path: "/usr/local/cargo"
  register: rust_directories
  tags:
    - rust

- name: Download Rust installer
  ansible.builtin.get_url:
    url: https://sh.rustup.rs
    dest: "/tmp/sh.rustup.rs"
    mode: '0755'
    force: 'yes'
  when: not rust_directories.stat.exists
  tags:
    - rust

- name: Install Rust to custom directories
  ansible.builtin.command:
    cmd: |
      env CARGO_HOME=/usr/local/cargo RUSTUP_HOME=/usr/local/rustup /tmp/sh.rustup.rs -y --no-modify-path
  environment:
    CARGO_HOME: "/usr/local/cargo"
    RUSTUP_HOME: "/usr/local/rustup"
  when: not rust_directories.stat.exists
  tags:
    - rust

- name: Set Rust environment variables
  ansible.builtin.blockinfile:
    path: "/etc/profile.d/rust.sh"
    block: |
      export CARGO_HOME=/usr/local/cargo
      export RUSTUP_HOME=/usr/local/rustup
      export PATH=/usr/local/cargo/bin:$PATH
    create: yes
    owner: root
    group: root
    mode: '0644'
  tags:
    - rust
...
