# Standards: 0.2
---
- name: Install required dependencies
  ansible.builtin.package:
    name: libssl-dev
    state: present

- name: Check if Rust is already installed for the user
  ansible.builtin.command:
    cmd: "{{ ansible_env.HOME }}/.cargo/bin/rustup --version"
  register: rust_check
  failed_when: False
  changed_when: False

- name: Download Rust installer if not present
  ansible.builtin.get_url:
    url: https://sh.rustup.rs
    dest: "/tmp/sh.rustup.rs"
    mode: '0755'
    force: False
  when: rust_check.rc != 0

- name: Install Rust for the user if not present
  ansible.builtin.shell:
    cmd: sh /tmp/sh.rustup.rs -y
  when: rust_check.rc != 0
  notify:
  - Add Rust to PATH for bash
  - Add Rust to PATH for zsh

- name: Update Rust toolchain to stable
  ansible.builtin.command:
    cmd: "{{ ansible_env.HOME }}/.cargo/bin/rustup default stable"

- name: Update Rust toolchain
  ansible.builtin.command:
    cmd: "{{ ansible_env.HOME }}/.cargo/bin/rustup update"

- name: Add the nightly and WebAssembly targets
  ansible.builtin.command:
    cmd: "{{ ansible_env.HOME }}/.cargo/bin/rustup update nightly"
...
